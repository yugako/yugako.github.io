(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{374:function(e,t,n){"use strict";n.r(t);var r,o,c=n(108),d=n.n(c),f=n(80),l=n(109),h=(n(195),(r={})["only-available-in-window"]="This method is available in a Window context.",r["only-available-in-sw"]="This method is available in a service worker context.",r["should-be-overriden"]="This method should be overriden by extended classes.",r["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",r["permission-default"]="The required permissions were not granted and dismissed instead.",r["permission-blocked"]="The required permissions were not granted and blocked instead.",r["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",r["notifications-blocked"]="Notifications have been blocked.",r["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",r["sw-registration-expected"]="A service worker registration was the expected input.",r["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",r["invalid-saved-token"]="Unable to access details of the saved token.",r["sw-reg-redundant"]="The service worker being used for push was made redundant.",r["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",r["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",r["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",r["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",r["token-update-no-token"]="FCM returned no token when updating the user to push.",r["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",r["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",r["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",r["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",r["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",r["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",r["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",r["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",r["failed-to-delete-token"]="Unable to delete the currently saved token.",r["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",r["bad-scope"]="The service worker scope must be a string with at least one character.",r["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",r["bad-subscription"]="The subscription must be a valid PushSubscription.",r["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",r["failed-delete-vapid-key"]="The VAPID key could not be deleted.",r["invalid-public-vapid-key"]="The public VAPID key must be a string.",r["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",r["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",r),w=new l.ErrorFactory("messaging","Messaging",h),v=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),_="https://fcmregistrations.googleapis.com/v1";function y(a,b){if(null==a||null==b)return!1;if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(var e=new DataView(a),t=new DataView(b),i=0;i<a.byteLength;i++)if(e.getUint8(i)!==t.getUint8(i))return!1;return!0}function k(e){return function(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,Object(f.__spread)(t)))}(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}!function(e){e.PUSH_MSG_RECEIVED="push-msg-received",e.NOTIFICATION_CLICKED="notification-clicked"}(o||(o={}));var m=function(){function e(){}return e.prototype.getToken=function(e,t,n){return Object(f.__awaiter)(this,void 0,void 0,(function(){var r,body,o,c,d,l;return Object(f.__generator)(this,(function(f){switch(f.label){case 0:return[4,S(e)];case 1:r=f.sent(),body=j(t,n),o={method:"POST",headers:r,body:JSON.stringify(body)},f.label=2;case 2:return f.trys.push([2,5,,6]),[4,fetch(T(e),o)];case 3:return[4,f.sent().json()];case 4:return c=f.sent(),[3,6];case 5:throw d=f.sent(),w.create("token-subscribe-failed",{errorInfo:d});case 6:if(c.error)throw l=c.error.message,w.create("token-subscribe-failed",{errorInfo:l});if(!c.token)throw w.create("token-subscribe-no-token");return[2,c.token]}}))}))},e.prototype.updateToken=function(e,t,n,r){return Object(f.__awaiter)(this,void 0,void 0,(function(){var o,body,c,d,l,h;return Object(f.__generator)(this,(function(f){switch(f.label){case 0:return[4,S(t)];case 1:o=f.sent(),body=j(n,r),c={method:"PATCH",headers:o,body:JSON.stringify(body)},f.label=2;case 2:return f.trys.push([2,5,,6]),[4,fetch(T(t)+"/"+e.fcmToken,c)];case 3:return[4,f.sent().json()];case 4:return d=f.sent(),[3,6];case 5:throw l=f.sent(),w.create("token-update-failed",{errorInfo:l});case 6:if(d.error)throw h=d.error.message,w.create("token-update-failed",{errorInfo:h});if(!d.token)throw w.create("token-update-no-token");return[2,d.token]}}))}))},e.prototype.deleteToken=function(e,t){return Object(f.__awaiter)(this,void 0,void 0,(function(){var n,r,o,c,d;return Object(f.__generator)(this,(function(f){switch(f.label){case 0:return[4,S(e)];case 1:n=f.sent(),r={method:"DELETE",headers:n},f.label=2;case 2:return f.trys.push([2,5,,6]),[4,fetch(T(e)+"/"+t.fcmToken,r)];case 3:return[4,f.sent().json()];case 4:if((o=f.sent()).error)throw c=o.error.message,w.create("token-unsubscribe-failed",{errorInfo:c});return[3,6];case 5:throw d=f.sent(),w.create("token-unsubscribe-failed",{errorInfo:d});case 6:return[2]}}))}))},e}();function T(e){return _+"/projects/"+e.options.projectId+"/registrations"}function S(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t;return Object(f.__generator)(this,(function(n){switch(n.label){case 0:return[4,e.installations().getToken()];case 1:return t=n.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})]}}))}))}function j(e,t){var n=k(e.getKey("p256dh")),r=k(e.getKey("auth")),body={web:{endpoint:e.endpoint,p256dh:n,auth:r}};return y(t.buffer,v.buffer)||(body.web.applicationPubKey=k(t)),body}function O(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var M="undefined",D="fcm_token_object_Store";function P(e){var t=indexedDB.open(M);t.onerror=function(e){},t.onsuccess=function(n){!function(e,t){if(e.objectStoreNames.contains(D)){var n=e.transaction(D).objectStore(D),r=new m,o=n.openCursor();o.onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},o.onsuccess=function(){var cursor=o.result;if(cursor){var n=cursor.value;r.deleteToken(t,n),cursor.continue()}else e.close(),indexedDB.deleteDatabase(M)}}}(t.result,e)}}var I=function(){function e(){this.dbPromise=null}return e.prototype.get=function(e){return this.createTransaction((function(t){return t.get(e)}))},e.prototype.getIndex=function(e,t){return this.createTransaction((function(n){return n.index(e).get(t)}))},e.prototype.put=function(e){return this.createTransaction((function(t){return t.put(e)}),"readwrite")},e.prototype.delete=function(e){return this.createTransaction((function(t){return t.delete(e)}),"readwrite")},e.prototype.closeDatabase=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(e){switch(e.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:e.sent().close(),this.dbPromise=null,e.label=2;case 2:return[2]}}))}))},e.prototype.createTransaction=function(e,t){return void 0===t&&(t="readonly"),Object(f.__awaiter)(this,void 0,void 0,(function(){var n,r,o,c;return Object(f.__generator)(this,(function(d){switch(d.label){case 0:return[4,this.getDb()];case 1:return n=d.sent(),r=n.transaction(this.objectStoreName,t),o=r.objectStore(this.objectStoreName),[4,C(e(o))];case 2:return c=d.sent(),[2,new Promise((function(e,t){r.oncomplete=function(){e(c)},r.onerror=function(){t(r.error)}}))]}}))}))},e.prototype.getDb=function(){var e=this;return this.dbPromise||(this.dbPromise=new Promise((function(t,n){var r=indexedDB.open(e.dbName,e.dbVersion);r.onsuccess=function(){t(r.result)},r.onerror=function(){e.dbPromise=null,n(r.error)},r.onupgradeneeded=function(t){return e.onDbUpgrade(r,t)}}))),this.dbPromise},e}();function C(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}var N=function(e){function t(t){var n=e.call(this)||this;return n.app=t,n.dbName="fcm_token_details_db",n.dbVersion=4,n.objectStoreName="fcm_token_object_Store",n}return Object(f.__extends)(t,e),t.prototype.onDbUpgrade=function(e,t){var n=e.result;switch(t.oldVersion){case 0:(o=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:P(this.app);case 2:var r=(o=e.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var cursor=r.result;if(cursor){var e=cursor.value,t=Object(f.__assign)({},e);e.createTime||(t.createTime=Date.now()),"string"==typeof e.vapidKey&&(t.vapidKey=O(e.vapidKey)),"string"==typeof e.auth&&(t.auth=O(e.auth).buffer),"string"==typeof e.auth&&(t.p256dh=O(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete t.fcmPushSet,cursor.update(t),cursor.continue()}};break;case 3:var o,c=(o=e.transaction.objectStore(this.objectStoreName)).openCursor();c.onsuccess=function(){var cursor=c.result;if(cursor){var e=cursor.value,t=Object(f.__assign)({},e);"string"==typeof e.fcmPushSet&&delete t.fcmPushSet,cursor.update(t),cursor.continue()}}}},t.prototype.getTokenDetailsFromToken=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(t){if(!e)throw w.create("bad-token");return K({fcmToken:e}),[2,this.getIndex("fcmToken",e)]}))}))},t.prototype.getTokenDetailsFromSWScope=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(t){if(!e)throw w.create("bad-scope");return K({swScope:e}),[2,this.get(e)]}))}))},t.prototype.saveTokenDetails=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(t){if(!e.swScope)throw w.create("bad-scope");if(!e.vapidKey)throw w.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw w.create("bad-subscription");if(!e.fcmSenderId)throw w.create("bad-sender-id");if(!e.fcmToken)throw w.create("bad-token");return K(e),[2,this.put(e)]}))}))},t.prototype.deleteToken=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var details;return Object(f.__generator)(this,(function(t){switch(t.label){case 0:return"string"!=typeof e||0===e.length?[2,Promise.reject(w.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(e)];case 1:if(!(details=t.sent()))throw w.create("delete-token-not-found");return[4,this.delete(details.swScope)];case 2:return t.sent(),[2,details]}}))}))},t}(I);function K(input){if(input.fcmToken&&("string"!=typeof input.fcmToken||0===input.fcmToken.length))throw w.create("bad-token");if(input.swScope&&("string"!=typeof input.swScope||0===input.swScope.length))throw w.create("bad-scope");if(input.vapidKey&&(!(input.vapidKey instanceof Uint8Array)||65!==input.vapidKey.length))throw w.create("bad-vapid-key");if(input.endpoint&&("string"!=typeof input.endpoint||0===input.endpoint.length))throw w.create("bad-subscription");if(input.auth&&!(input.auth instanceof ArrayBuffer))throw w.create("bad-subscription");if(input.p256dh&&!(input.p256dh instanceof ArrayBuffer))throw w.create("bad-subscription");if(input.fcmSenderId&&("string"!=typeof input.fcmSenderId||0===input.fcmSenderId.length))throw w.create("bad-sender-id")}var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}return Object(f.__extends)(t,e),t.prototype.onDbUpgrade=function(e){e.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},t.prototype.getVapidFromSWScope=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t;return Object(f.__generator)(this,(function(n){switch(n.label){case 0:if("string"!=typeof e||0===e.length)throw w.create("bad-scope");return[4,this.get(e)];case 1:return[2,(t=n.sent())?t.vapidKey:void 0]}}))}))},t.prototype.saveVapidDetails=function(e,t){return Object(f.__awaiter)(this,void 0,void 0,(function(){var details;return Object(f.__generator)(this,(function(n){if("string"!=typeof e||0===e.length)throw w.create("bad-scope");if(null===t||65!==t.length)throw w.create("bad-vapid-key");return details={swScope:e,vapidKey:t},[2,this.put(details)]}))}))},t.prototype.deleteVapidDetails=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t;return Object(f.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(e)];case 1:if(!(t=n.sent()))throw w.create("delete-scope-not-found");return[4,this.delete(e)];case 2:return n.sent(),[2,t]}}))}))},t}(I),W=function(){function e(e){var t=this;if(this.app=e,this.vapidDetailsModel=new V,this.subscriptionManager=new m,!e.options.messagingSenderId||"string"!=typeof e.options.messagingSenderId)throw w.create("bad-sender-id");this.INTERNAL={delete:function(){return t.delete()}},this.tokenDetailsModel=new N(e)}return e.prototype.getToken=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o;return Object(f.__generator)(this,(function(c){switch(c.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw w.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return t=c.sent(),[4,this.getPublicVapidKey_()];case 2:return n=c.sent(),[4,this.getPushSubscription(t,n)];case 3:return r=c.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(t.scope)];case 4:return(o=c.sent())?[2,this.manageExistingToken(t,r,n,o)]:[2,this.getNewToken(t,r,n)]}}))}))},e.prototype.manageExistingToken=function(e,t,n,r){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(o){switch(o.label){case 0:return function(e,t,n){if(!n.vapidKey||!y(t.buffer,n.vapidKey.buffer))return!1;var r=e.endpoint===n.endpoint,o=y(e.getKey("auth"),n.auth),c=y(e.getKey("p256dh"),n.p256dh);return r&&o&&c}(t,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(e,t,n,r)]:[3,1];case 1:return[4,this.deleteTokenFromDB(r.fcmToken)];case 2:return o.sent(),[2,this.getNewToken(e,t,n)];case 3:return[2]}}))}))},e.prototype.updateToken=function(e,t,n,r){return Object(f.__awaiter)(this,void 0,void 0,(function(){var o,c,d;return Object(f.__generator)(this,(function(f){switch(f.label){case 0:return f.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(r,this.app,t,n)];case 1:return o=f.sent(),c={swScope:e.scope,vapidKey:n,fcmSenderId:this.app.options.messagingSenderId,fcmToken:o,createTime:Date.now(),endpoint:t.endpoint,auth:t.getKey("auth"),p256dh:t.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(c)];case 2:return f.sent(),[4,this.vapidDetailsModel.saveVapidDetails(e.scope,n)];case 3:return f.sent(),[2,o];case 4:return d=f.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw f.sent(),d;case 6:return[2]}}))}))},e.prototype.getNewToken=function(e,t,n){return Object(f.__awaiter)(this,void 0,void 0,(function(){var r,o;return Object(f.__generator)(this,(function(c){switch(c.label){case 0:return[4,this.subscriptionManager.getToken(this.app,t,n)];case 1:return r=c.sent(),o={swScope:e.scope,vapidKey:n,fcmSenderId:this.app.options.messagingSenderId,fcmToken:r,createTime:Date.now(),endpoint:t.endpoint,auth:t.getKey("auth"),p256dh:t.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return c.sent(),[4,this.vapidDetailsModel.saveVapidDetails(e.scope,n)];case 3:return c.sent(),[2,r]}}))}))},e.prototype.deleteToken=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(f.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(e)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(t=r.sent())?[4,t.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}}))}))},e.prototype.deleteTokenFromDB=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t;return Object(f.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(e)];case 1:return t=n.sent(),[4,this.subscriptionManager.deleteToken(this.app,t)];case 2:return n.sent(),[2]}}))}))},e.prototype.getPushSubscription=function(e,t){return Object(f.__awaiter)(this,void 0,void 0,(function(){var n;return Object(f.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})]}}))}))},e.prototype.requestPermission=function(){throw w.create("only-available-in-window")},e.prototype.useServiceWorker=function(e){throw w.create("only-available-in-window")},e.prototype.usePublicVapidKey=function(e){throw w.create("only-available-in-window")},e.prototype.onMessage=function(e,t,n){throw w.create("only-available-in-window")},e.prototype.onTokenRefresh=function(e,t,n){throw w.create("only-available-in-window")},e.prototype.setBackgroundMessageHandler=function(e){throw w.create("only-available-in-sw")},e.prototype.delete=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(e){switch(e.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return e.sent(),[2]}}))}))},e.prototype.getNotificationPermission_=function(){return Notification.permission},e.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},e.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},e.prototype.getSubscriptionManager=function(){return this.subscriptionManager},e}();var U=function(e){function t(t){var n=e.call(this,t)||this;return n.bgMessageHandler=null,self.addEventListener("push",(function(e){n.onPush(e)})),self.addEventListener("pushsubscriptionchange",(function(e){n.onSubChange(e)})),self.addEventListener("notificationclick",(function(e){n.onNotificationClick(e)})),n}return Object(f.__extends)(t,e),t.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},t.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},t.prototype.onNotificationClick=function(e){e.waitUntil(this.onNotificationClick_(e))},t.prototype.onPush_=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,c,d;return Object(f.__generator)(this,(function(f){switch(f.label){case 0:if(!e.data)return[2];try{t=e.data.json()}catch(e){return[2]}return[4,this.hasVisibleClients_()];case 1:return f.sent()?[2,this.sendMessageToWindowClients_(t)]:(n=this.getNotificationData_(t))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return o=f.sent(),c=n.actions,d=Notification.maxActions,c&&d&&c.length>d&&console.warn("This browser only supports "+d+" actions.The remaining actions will not be displayed."),[2,o.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:return f.sent(),[2];case 5:return[2]}}))}))},t.prototype.onSubChange_=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(f.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=o.sent(),[3,3];case 2:throw t=o.sent(),w.create("unable-to-resubscribe",{errorInfo:t});case 3:return o.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return o.sent(),[3,8];case 5:return n=o.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(r=o.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw o.sent(),n;case 8:return[2]}}))}))},t.prototype.onNotificationClick_=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t,link,n,r;return Object(f.__generator)(this,(function(c){switch(c.label){case 0:if(!(e.notification&&e.notification.data&&e.notification.data.FCM_MSG))return[2];if(e.action)return[2];if(e.stopImmediatePropagation(),e.notification.close(),!(t=e.notification.data.FCM_MSG).notification)return[2];if(!(link=t.fcmOptions&&t.fcmOptions.link||t.notification.click_action)){if(!(t.data&&"google.c.a.c_id"in t.data))return[2];link=self.location.origin}return[4,this.getWindowClient_(link)];case 1:return(n=c.sent())?[3,4]:[4,self.clients.openWindow(link)];case 2:return n=c.sent(),[4,(d=3e3,new Promise((function(e){setTimeout(e,d)})))];case 3:return c.sent(),[3,6];case 4:return[4,n.focus()];case 5:n=c.sent(),c.label=6;case 6:return n?(delete t.notification,delete t.fcmOptions,r=E(o.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(n,r)]):[2]}var d}))}))},t.prototype.getNotificationData_=function(e){var t;if(e&&"object"==typeof e.notification){var n=Object(f.__assign)({},e.notification);return n.data=Object(f.__assign)(Object(f.__assign)({},e.notification.data),((t={}).FCM_MSG=e,t)),n}},t.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw w.create("bg-handler-function-expected");this.bgMessageHandler=e},t.prototype.getWindowClient_=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i;return Object(f.__generator)(this,(function(o){switch(o.label){case 0:return t=new URL(e,self.location.href).href,[4,A()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===t){r=n[i];break}return[2,r]}}))}))},t.prototype.attemptToMessageClient_=function(e,t){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(n){if(!e)throw w.create("no-window-client-to-msg");return e.postMessage(t),[2]}))}))},t.prototype.hasVisibleClients_=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(e){switch(e.label){case 0:return[4,A()];case 1:return[2,e.sent().some((function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")}))]}}))}))},t.prototype.sendMessageToWindowClients_=function(e){return Object(f.__awaiter)(this,void 0,void 0,(function(){var t,n,r=this;return Object(f.__generator)(this,(function(c){switch(c.label){case 0:return[4,A()];case 1:return t=c.sent(),n=E(o.PUSH_MSG_RECEIVED,e),[4,Promise.all(t.map((function(e){return r.attemptToMessageClient_(e,n)})))];case 2:return c.sent(),[2]}}))}))},t.prototype.getSWRegistration_=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(e){return[2,self.registration]}))}))},t.prototype.getPublicVapidKey_=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(f.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=n.sent()))throw w.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(t=n.sent())?[2,v]:[2,t]}}))}))},t}(W);function A(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function E(e,t){return{firebaseMessagingType:e,firebaseMessagingData:t}}var x,F,R=function(e){function t(t){var n=e.call(this,t)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=Object(l.createSubscribe)((function(e){n.messageObserver=e})),n.onTokenRefreshInternal=Object(l.createSubscribe)((function(e){n.tokenRefreshObserver=e})),n.setupSWMessageListener_(),n}return Object(f.__extends)(t,e),t.prototype.requestPermission=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){var e;return Object(f.__generator)(this,(function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?w.create("permission-blocked"):w.create("permission-default")}}))}))},t.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw w.create("sw-registration-expected");if(null!=this.registrationToUse)throw w.create("use-sw-before-get-token");this.registrationToUse=e},t.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw w.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw w.create("use-public-key-before-get-token");var t=O(e);if(65!==t.length)throw w.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=t},t.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},t.prototype.onTokenRefresh=function(e,t,n){return"function"==typeof e?this.onTokenRefreshInternal(e,t,n):this.onTokenRefreshInternal(e)},t.prototype.waitForRegistrationToActivate_=function(e){var t=e.installing||e.waiting||e.active;return new Promise((function(n,r){if(t)if("activated"!==t.state)if("redundant"!==t.state){var o=function(){if("activated"===t.state)n(e);else{if("redundant"!==t.state)return;r(w.create("sw-reg-redundant"))}t.removeEventListener("statechange",o)};t.addEventListener("statechange",o)}else r(w.create("sw-reg-redundant"));else n(e);else r(w.create("no-sw-in-reg"))}))},t.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch((function(e){throw w.create("failed-serviceworker-registration",{browserErrorMessage:e.message})})).then((function(t){return e.waitForRegistrationToActivate_(t).then((function(){return e.registrationToUse=t,t.update(),t}))})))},t.prototype.getPublicVapidKey_=function(){return Object(f.__awaiter)(this,void 0,void 0,(function(){return Object(f.__generator)(this,(function(e){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,v]}))}))},t.prototype.setupSWMessageListener_=function(){var e=this;navigator.serviceWorker.addEventListener("message",(function(t){if(t.data&&t.data.firebaseMessagingType&&t.data.firebaseMessagingData){var n=t.data,r=n.firebaseMessagingType,c=n.firebaseMessagingData;e.messageObserver&&e.messageObserver.next(c);var data=c.data;if(data&&"google.c.a.c_id"in data&&"1"===data["google.c.a.e"]){var d=function(e){switch(e){case o.NOTIFICATION_CLICKED:return"notification_open";case o.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(r);e.app.INTERNAL.analytics.logEvent(d,{message_name:data["google.c.a.c_l"],message_id:data["google.c.a.c_id"],message_time:data["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}}),!1)},t}(W);function L(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}x=d.a,F={isSupported:L},x.INTERNAL.registerService("messaging",(function(e){if(!L())throw w.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new U(e):new R(e)}),F)}}]);